<!DOCTYPE html>
<html>
  <head>
    <title>Networths</title>
    {% load static %}
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://code.jquery.com/jquery-3.5.1.min.js"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"
    ></script>
  </head>
  <body
    style="
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f9f9f9;
    "
  >
    <!-- Notification Section -->
    {% if latest_notification %}
    <div class="notification-bar">{{ latest_notification.message }}</div>
    {% endif %}

    <h2 style="color: #333">Profiles of Richest People</h2>

    <div
      style="
        display: inline-block;
        padding: 20px;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        margin-bottom: 20px;
      "
    >
      <form method="post" style="margin: 0 auto">
        {% csrf_token %} {{ form.as_p }}
        <button
          type="submit"
          style="
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
          "
        >
          Save
        </button>
      </form>
    </div>

    <h3 style="color: #333">User Saved Data</h3>
    <div
      style="
        display: inline-block;
        padding: 20px;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        margin-bottom: 20px;
      "
    >
      <table
        id="profilesTable"
        class="table table-striped table-bordered"
        style="width: 100%"
      >
        <thead class="thead-light">
          <tr>
            <th>Name</th>
            <th>Net Worth</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for profile in profiles %}
          <tr>
            <td>{{ profile.name }}</td>
            <td>{{ profile.networth }}</td>
            <td>
              <a
                href="{% url 'update' profile.id %}"
                class="btn btn-primary btn-sm"
                >Edit</a
              >
              <form
                action="{% url 'delete' profile.id %}"
                method="post"
                style="display: inline"
              >
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm">
                  Delete
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <h3 style="color: #333">Net Worth Distribution</h3>
    <div
      style="
        display: inline-block;
        padding: 20px;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      "
    >
      <canvas id="myPieChart" style="margin-bottom: 20px"></canvas>
      <script>
        var ctx = document.getElementById("myPieChart").getContext("2d");
        var chartData = JSON.parse("{{ chart_data|escapejs }}");
        var myPieChart = new Chart(ctx, {
          type: "pie",
          data: chartData,
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: "top",
              },
              tooltip: {
                callbacks: {
                  label: function (tooltipItem) {
                    var label = tooltipItem.label || "";
                    if (label) {
                      label += ": ";
                    }
                    label += Math.round(tooltipItem.raw * 100) / 100;
                    return label;
                  },
                },
              },
            },
          },
        });
      </script>
      <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button
          type="submit"
          style="
            padding: 10px 20px;
            background-color: #f10707;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
          "
        >
          Logout
        </button>
      </form>
      <form method="post" action="{% url 'notifications' %}">
        {% csrf_token %}
        <button
          type="submit"
          style="
            padding: 10px 20px;
            background-color: #d416b2;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
          "
        >
          Notifications
        </button>
      </form>
    </div>

    <script>
      $(document).ready(function () {
        $("#profilesTable").DataTable();
      });
    </script>
  </body>
</html>
